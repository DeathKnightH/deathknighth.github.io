<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL 基础 | DeathKnightH&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="记录一些思路和细节">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.82488b1b.js" as="script"><link rel="preload" href="/assets/js/2.1f448a3c.js" as="script"><link rel="preload" href="/assets/js/27.b4e90488.js" as="script"><link rel="prefetch" href="/assets/js/10.48292716.js"><link rel="prefetch" href="/assets/js/11.07267a7d.js"><link rel="prefetch" href="/assets/js/12.762ed7ee.js"><link rel="prefetch" href="/assets/js/13.1764ff4f.js"><link rel="prefetch" href="/assets/js/14.6c6790c5.js"><link rel="prefetch" href="/assets/js/15.bc0cc800.js"><link rel="prefetch" href="/assets/js/16.618b0843.js"><link rel="prefetch" href="/assets/js/17.320cbd40.js"><link rel="prefetch" href="/assets/js/18.f1bfd7da.js"><link rel="prefetch" href="/assets/js/19.590703f0.js"><link rel="prefetch" href="/assets/js/20.29de613d.js"><link rel="prefetch" href="/assets/js/21.e9cbee33.js"><link rel="prefetch" href="/assets/js/22.c27ed56d.js"><link rel="prefetch" href="/assets/js/23.cd08a5db.js"><link rel="prefetch" href="/assets/js/24.683b249a.js"><link rel="prefetch" href="/assets/js/25.9c50e57f.js"><link rel="prefetch" href="/assets/js/26.d714bc97.js"><link rel="prefetch" href="/assets/js/28.b975d6a6.js"><link rel="prefetch" href="/assets/js/29.9e324cda.js"><link rel="prefetch" href="/assets/js/3.414b4908.js"><link rel="prefetch" href="/assets/js/30.f965cda4.js"><link rel="prefetch" href="/assets/js/31.44b23c9c.js"><link rel="prefetch" href="/assets/js/32.dd151b01.js"><link rel="prefetch" href="/assets/js/33.1a54bdee.js"><link rel="prefetch" href="/assets/js/34.10ec444f.js"><link rel="prefetch" href="/assets/js/35.6474ce1b.js"><link rel="prefetch" href="/assets/js/36.f0e70e4e.js"><link rel="prefetch" href="/assets/js/37.abb17dd6.js"><link rel="prefetch" href="/assets/js/38.fce37c0e.js"><link rel="prefetch" href="/assets/js/39.c0082bf4.js"><link rel="prefetch" href="/assets/js/4.e268862a.js"><link rel="prefetch" href="/assets/js/40.4ad7c1c1.js"><link rel="prefetch" href="/assets/js/41.a5a22183.js"><link rel="prefetch" href="/assets/js/42.85042897.js"><link rel="prefetch" href="/assets/js/43.1e060797.js"><link rel="prefetch" href="/assets/js/44.0a513c91.js"><link rel="prefetch" href="/assets/js/45.cb4ce616.js"><link rel="prefetch" href="/assets/js/46.78771cc0.js"><link rel="prefetch" href="/assets/js/47.562e1660.js"><link rel="prefetch" href="/assets/js/48.5a92f1c4.js"><link rel="prefetch" href="/assets/js/49.75dcd521.js"><link rel="prefetch" href="/assets/js/5.0c896d33.js"><link rel="prefetch" href="/assets/js/50.0a4f518d.js"><link rel="prefetch" href="/assets/js/51.ef5999c4.js"><link rel="prefetch" href="/assets/js/6.2958d7f8.js"><link rel="prefetch" href="/assets/js/7.443a2828.js"><link rel="prefetch" href="/assets/js/8.535acfb0.js"><link rel="prefetch" href="/assets/js/9.e55eefe2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DeathKnightH's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法笔记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">
  总览
</a></li><li class="dropdown-item"><!----> <a href="/java/thread/" class="nav-link">
  多线程
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  常用工具
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法笔记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">
  总览
</a></li><li class="dropdown-item"><!----> <a href="/java/thread/" class="nav-link">
  多线程
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  常用工具
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SQL 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/sql/SQL.html#_1-语法基础" class="sidebar-link">1. 语法基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_1-1-ddl" class="sidebar-link">1.1 DDL</a></li><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_1-2-dml" class="sidebar-link">1.2 DML</a></li></ul></li><li><a href="/database/sql/SQL.html#_2-存储程序" class="sidebar-link">2. 存储程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_2-1-复合语句" class="sidebar-link">2.1 复合语句</a></li><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_2-2-存储函数" class="sidebar-link">2.2 存储函数</a></li><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_2-3-存储过程" class="sidebar-link">2.3 存储过程</a></li><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_2-4-触发器" class="sidebar-link">2.4 触发器</a></li><li class="sidebar-sub-header"><a href="/database/sql/SQL.html#_2-5-事件" class="sidebar-link">2.5 事件</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="sql-基础"><a href="#sql-基础" class="header-anchor">#</a> SQL 基础</h1> <p>Structured Query Language（SQL，结构化查询语言）又称 ANSI SQL，由 ANSI 标准委员会管理。具体商业应用中每个数据库产品通常都有自己的 SQL 增强实现，比如 oracle 的 PL/SQL，sql server 的 Transact-SQL。</p> <h2 id="_1-语法基础"><a href="#_1-语法基础" class="header-anchor">#</a> 1. 语法基础</h2> <h3 id="_1-1-ddl"><a href="#_1-1-ddl" class="header-anchor">#</a> 1.1 DDL</h3> <p>Data definition language 数据定义语言。现在常用的数据库设计软件都可以直接导出 DDL 语句，通常不会自己手写 DDL，这里只列举一下常用 DDL 的使用方法，不做深入研究。</p> <h4 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE DATABASE test; // 创建名为 test 的数据库
USE test; // 使用名为 test 的数据库
DROP DATABASE test; // 删除名为 test 的数据库
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="表"><a href="#表" class="header-anchor">#</a> 表</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE TABLE testtable(
  column1 datatype1,
  ...
  columnn datatypen
  {,key define}{,index define}
); // 创建名为 testtable 的数据表

DROP TABLE testtable; // 删除名为 testtable 的数据表

ALTER TABLE testtable ADD columnx datatypex; // 修改数据表，增加列
ALTER TABLE testtable DROP COLUMN column1;   // 修改数据表，删除列 column1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="视图"><a href="#视图" class="header-anchor">#</a> 视图</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE VIEW testview AS subquery; // 根据子查询 subquery 创建视图 testview
DROP VIEW testview; // 删除视图 testview
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_1-2-dml"><a href="#_1-2-dml" class="header-anchor">#</a> 1.2 DML</h3> <p>Data manipulation language 数据操纵语言。日常开发中使用频率最高的 sql，通常说的增删改查都属于 DML。</p> <h4 id="_1-2-1-insert-插入"><a href="#_1-2-1-insert-插入" class="header-anchor">#</a> 1.2.1 insert 插入</h4> <ul><li>普通插入，将一条记录插入 tablename 表，其中 column1 值为 value1，column2 值为 value2。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO tablename(column1, column2)
VALUES(value1, value2);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>将查询结果集直接插入。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO tablename(column1, column2)
SELECT col1, col2
FROM table2;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-2-2-update-更新"><a href="#_1-2-2-update-更新" class="header-anchor">#</a> 1.2.2 update 更新</h4> <p>更新 tablename 表，将其中所有符合 condition 记录的 column1 属性更新为 value1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>UPDATE tablename
SET column1 = value1
WHERE condition;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_1-2-3-delete-删除"><a href="#_1-2-3-delete-删除" class="header-anchor">#</a> 1.2.3 delete 删除</h4> <p>删除 tablename 表中所有符合 condition 的记录，如果 condition 恒为 true，则删除表的所有记录。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DELETE FROM tablename
WHERE condition;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>还有一个 DDL 语句可以实现删除表的所有记录：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>TRUNCATE TABLE tablename;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-2-4-select-查询"><a href="#_1-2-4-select-查询" class="header-anchor">#</a> 1.2.4 select 查询</h4> <ul><li>基本查询</li></ul> <p>查询 tablename 表中的所有数据。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT * FROM tablename;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>也可以不跟 <code>FROM</code> 子句，用于直接计算表达式。常用于检查数据库连接，比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT 1;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>条件查询</li></ul> <p>可以只查询符合条件的数据。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT * FROM tablename 
WHERE condition;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>condition</code> 由逻辑表达式或者子条件组成，各子条件可以由 <code>NOT</code>/<code>AND</code>/<code>OR</code> 来修饰和连接。
不使用括号时，优先级从高到低依次是 <code>NOT</code>/<code>AND</code>/<code>OR</code>。</p> <ul><li>投影查询</li></ul> <p>可以只查询部分属性(列)，这种操作称为投影。同时列名也可以映射为自定义的名称：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT column1 AS col1, column2 AS col2
FROM tablename
WHERE condition;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>查询 <code>tablename</code> 表中符合 <code>condition</code> 条件的数据，最后只显示 column1 和 column2 的属性值，同时将 column1 的名称映射为 col1，将 column2 的名称映射为 col2.</p> <ul><li>查询结果排序</li></ul> <p>查询结果默认是以主键排序的。用户可以使用 <code>ORDER BY</code> 子句实现自定义的结果集排序：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT id, name, age
FROM person
WHERE id &lt; 100
ORDER BY age;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>顺序分为升序(ASC) 和降序(DESC)，默认不写就是升序，如果使用降序：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT id, name, age
FROM person
WHERE id &lt; 100
ORDER BY age DESC;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以同时对多列属性进行排序，比如有两个列参与排序：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT id, name, age, score
FROM person
WHERE id &lt; 100
ORDER BY age DESC, score;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>先按照 age 倒序排列，age 属性相同时按照 score 正序排列。</p> <ul><li>查询结果分组</li></ul> <p>使用 <code>GROUP BY</code> 子句对结果集进行分组：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT age, score, count(*) AS sum
FROM person
WHERE id &lt; 100
GROUP BY age, score
ORDER BY sum;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>1、<code>GROUP BY</code> 在 <code>WHERE</code> 后，<code>ORDER BY</code> 前。</p> <p>2、<code>SELECT</code> 子句选择的属性必须在 <code>GROUP BY</code> 中出现（除汇总函数外，例如 count(*)）。</p> <p>3、如果分组的属性在某些记录中为 NULL，则 NULL 会单独分组。</p> <ul><li>分页查询</li></ul> <p>当结果集过大而一次不用使用全部结果集时，可以使用 <code>LIMIT m OFFSET n</code> 子句进行手动分页：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT id, name, age, score
FROM person
ORDER BY age DESC, score
LIMIT 5 OFFSET 0;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>每页5条记录，当前取第1页。</p> <ul><li>连接查询
<ul><li>内连接，又称等值连接，只保留两表匹配字段。</li> <li>左(外)连接，保留左侧表未匹配字段。</li> <li>右(外)连接，保留右侧表未匹配字段。</li> <li>全外连接 ，保留所有未匹配字段。</li></ul></li> <li>笛卡尔积查询</li></ul> <p>假设有两张表，记录数分别为 M 和 N，将两张表的记录一一组合形成 M*N 行记录的结果集就是笛卡尔积。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT * 
FROM students, classes;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>实际应用中要尽量避免使用笛卡尔积，因为查询结果可能会很大，比如两张超过1万条记录的表进行笛卡尔积查询，结果集超过1亿条。</p> <ul><li>组合查询</li></ul> <p>使用 <code>UNION</code> 关键字可以将两个查询结果组合起来，两个查询结果集分别为 M 行和 N 行，则组合结果有 M + N 行。</p> <p>使用前提是两个查询结果集列一致。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT name,age,score
FROM student1
WHERE age = 10
UNION
SELECT name,age,score
FROM student2
WHERE age = 18
ORDER BY score;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>组合查询只能有一个 <code>ORDER BY</code> 子句，且必须在最后。</p> <p>默认会去重，如果不去重，需要使用 <code>UNION ALL</code> 关键字。</p> <ul><li>子查询</li></ul> <p>子查询也是查询的一种，结果集只能有 1 列。结果集常用做其他查询的条件/结果的组成部分。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SELECT *
FROM student
WHERE classid IN(SELECT classid
                  FROM class
                  WHERE rank &gt; 1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_2-存储程序"><a href="#_2-存储程序" class="header-anchor">#</a> 2. 存储程序</h2> <p>Stored Program 是一种存储对象，功能和高级语言编写的程序类似，封装了一系列的 SQL 操作，有的可以被调用、有的可以被触发。</p> <p><em>ps:由于存储程序大多依赖于具体数据库实现，这里仅以 MySQL 为例进行描述。</em></p> <h3 id="_2-1-复合语句"><a href="#_2-1-复合语句" class="header-anchor">#</a> 2.1 复合语句</h3> <p>编写存储程序常用到复合语句，这种语句包含多条 SQL 语句，同时还可以使用逻辑判断/条件语句/循环/变量，每个语句由分号 <code>;</code> 结束。</p> <p>整体的复合语句由 <code>BEGIN</code> 开始，<code>END;</code> 结束。</p> <p>特别的，如果使用MySQL客户端命令行编写复合语句，由于 <code>;</code> 同时也是客户端的默认分隔符，可以使用 <code>delimiter</code> 命令将分隔符先临时改为其他符号，在编写完复合语句后再改回来，例如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>delimiter $
CREATE PROCEDURE test()
BEGIN
  SELECT ...... ;
  SELECT ...... ;
END$
delimiter ;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-2-存储函数"><a href="#_2-2-存储函数" class="header-anchor">#</a> 2.2 存储函数</h3> <p>Stored Function 可以看做用户自定义的函数，创建/修改存储函数需要有管理权限。</p> <p>存储函数不能修改数据，只能包含查询语句和计算过程。基本语法如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CREATE FUNCTION test([param_list])
  RETURN type
  routine_stmt // 复合语句
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>存储函数有且只能有一个返回值。要返回多个值，要么在一个查询语句中调用多个存储函数，要么使用存储过程。</p> <h3 id="_2-3-存储过程"><a href="#_2-3-存储过程" class="header-anchor">#</a> 2.3 存储过程</h3> <p>Stored procedure</p> <h3 id="_2-4-触发器"><a href="#_2-4-触发器" class="header-anchor">#</a> 2.4 触发器</h3> <h3 id="_2-5-事件"><a href="#_2-5-事件" class="header-anchor">#</a> 2.5 事件</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/24/2021, 12:15:59 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.82488b1b.js" defer></script><script src="/assets/js/2.1f448a3c.js" defer></script><script src="/assets/js/27.b4e90488.js" defer></script>
  </body>
</html>
