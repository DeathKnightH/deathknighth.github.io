(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{464:function(e,a,t){"use strict";t.r(a);var n=t(44),s=Object(n.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"spring-bean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spring-bean"}},[e._v("#")]),e._v(" Spring Bean")]),e._v(" "),t("h2",{attrs:{id:"_1-怎么配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-怎么配置"}},[e._v("#")]),e._v(" 1. 怎么配置")]),e._v(" "),t("p",[e._v("3种方式：")]),e._v(" "),t("ul",[t("li",[e._v("xml 配置")]),e._v(" "),t("li",[e._v("注解配置")]),e._v(" "),t("li",[e._v("java 配置类")])]),e._v(" "),t("h2",{attrs:{id:"_2-作用域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-作用域"}},[e._v("#")]),e._v(" 2. 作用域")]),e._v(" "),t("p",[e._v("bean 在声明时默认是单例模式的，即整个应用上下文中只有一个实例。实际 bean 的作用域可以在配置时一起声明：")]),e._v(" "),t("ul",[t("li",[e._v("singleton：单例，默认就是这个。")]),e._v(" "),t("li",[e._v("prototype：每次调用都是一个新的实例。")]),e._v(" "),t("li",[e._v("request：HTTP 的每次 Request 请求都会创建一个，仅在当前的 Request 中有效。")]),e._v(" "),t("li",[e._v("session：每一个来自新 session 的 HTTP 请求都会创建一个，仅在当前 session 中有效。")])]),e._v(" "),t("p",[e._v("使用 xml 配置 bean 时配置作用域，写在 "),t("code",[e._v("scope")]),e._v(" 属性中：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<bean id="..." class="..." scope="prototype"></bean>\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("使用注解配置 bean 时配置作用域，可以使用 "),t("code",[e._v("@Scope")]),e._v(" 注解：\n@Bean\n@Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)\npublic Person personPrototype() {\nreturn new Person();\n}")]),e._v(" "),t("h2",{attrs:{id:"_3-生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-生命周期"}},[e._v("#")]),e._v(" 3. 生命周期")]),e._v(" "),t("p",[e._v("这部分只针对 "),t("code",[e._v("singleton")]),e._v(" 作用域的 bean，其他作用域 spring 只负责创建 bean。")]),e._v(" "),t("p",[e._v("以这个经典的生命周期图为主线描述：\n"),t("img",{attrs:{src:"https://user-images.githubusercontent.com/19852729/143600298-4d3491aa-8641-4a44-8bf6-9be4fbc9215a.png",alt:"image"}})]),e._v(" "),t("ol",[t("li",[e._v("Instantiate:\n"),t("ul",[t("li",[e._v("容器查找配置中的 bean 配置。")]),e._v(" "),t("li",[e._v("容器利用反射 API 创建一个 bean 实例。")])])]),e._v(" "),t("li",[e._v("Populate properties:\n"),t("ul",[t("li",[e._v("如果配置涉及属性值，调用 "),t("code",[e._v("set()")]),e._v(" 方法设置属性值。")])])]),e._v(" "),t("li",[e._v("BeanNameAware's setBeanName():\n"),t("ul",[t("li",[e._v("如果 bean 实现了 "),t("code",[e._v("BeanNameAware")]),e._v(" 接口，就调用 "),t("code",[e._v("setBeanName()")]),e._v(" 方法设置 bean 的名称。")])])]),e._v(" "),t("li",[e._v("BeanFactoryAware's setBeanFactory():\n"),t("ul",[t("li",[e._v("如果 bean 实现了 "),t("code",[e._v("BeanFactoryAware")]),e._v(" 接口，就调用 "),t("code",[e._v("setBeanFactory()")]),e._v(" 方法设置")])])]),e._v(" "),t("li",[e._v("ApplicationContextAware's setApplicationContext():")])]),e._v(" "),t("h2",{attrs:{id:"_4-单例-bean-的线程安全问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-单例-bean-的线程安全问题"}},[e._v("#")]),e._v(" 4. 单例 bean 的线程安全问题")]),e._v(" "),t("p",[e._v("因为 bean 在 IOC 中默认是全局单例的，在多线程应用中会有线程安全问题。一般开发中会采用如下方法解决：")]),e._v(" "),t("ul",[t("li",[e._v("使用单例 bean 时尽量保证无状态（即不声明实例变量）。")]),e._v(" "),t("li",[e._v("一定要使用实例变量尽量放在 ThreadLocal 中。")]),e._v(" "),t("li",[e._v("需要使用多线程的功能尽量自己在代码中 new 对象，自己管理生命周期和共享数据。")])])])}),[],!1,null,null,null);a.default=s.exports}}]);