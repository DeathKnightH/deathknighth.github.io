(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{404:function(s,e,a){"use strict";a.r(e);var t=a(44),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"sql-基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-基础"}},[s._v("#")]),s._v(" SQL 基础")]),s._v(" "),a("p",[s._v("Structured Query Language（SQL，结构化查询语言）又称 ANSI SQL，由 ANSI 标准委员会管理。具体商业应用中每个数据库产品通常都有自己的 SQL 增强实现，比如 oracle 的 PL/SQL，sql server 的 Transact-SQL。")]),s._v(" "),a("h2",{attrs:{id:"_1-语法基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法基础"}},[s._v("#")]),s._v(" 1. 语法基础")]),s._v(" "),a("h3",{attrs:{id:"_1-1-ddl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ddl"}},[s._v("#")]),s._v(" 1.1 DDL")]),s._v(" "),a("p",[s._v("Data definition language 数据定义语言。现在常用的数据库设计软件都可以直接导出 DDL 语句，通常不会自己手写 DDL，这里只列举一下常用 DDL 的使用方法，不做深入研究。")]),s._v(" "),a("h4",{attrs:{id:"数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库"}},[s._v("#")]),s._v(" 数据库")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE DATABASE test; // 创建名为 test 的数据库\nUSE test; // 使用名为 test 的数据库\nDROP DATABASE test; // 删除名为 test 的数据库\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表"}},[s._v("#")]),s._v(" 表")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TABLE testtable(\n  column1 datatype1,\n  ...\n  columnn datatypen\n  {,key define}{,index define}\n); // 创建名为 testtable 的数据表\n\nDROP TABLE testtable; // 删除名为 testtable 的数据表\n\nALTER TABLE testtable ADD columnx datatypex; // 修改数据表，增加列\nALTER TABLE testtable DROP COLUMN column1;   // 修改数据表，删除列 column1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图"}},[s._v("#")]),s._v(" 视图")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE VIEW testview AS subquery; // 根据子查询 subquery 创建视图 testview\nDROP VIEW testview; // 删除视图 testview\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_1-2-dml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-dml"}},[s._v("#")]),s._v(" 1.2 DML")]),s._v(" "),a("p",[s._v("Data manipulation language 数据操纵语言。日常开发中使用频率最高的 sql，通常说的增删改查都属于 DML。")]),s._v(" "),a("h4",{attrs:{id:"_1-2-1-insert-插入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-insert-插入"}},[s._v("#")]),s._v(" 1.2.1 insert 插入")]),s._v(" "),a("ul",[a("li",[s._v("普通插入，将一条记录插入 tablename 表，其中 column1 值为 value1，column2 值为 value2。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSERT INTO tablename(column1, column2)\nVALUES(value1, value2);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("将查询结果集直接插入。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSERT INTO tablename(column1, column2)\nSELECT col1, col2\nFROM table2;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_1-2-2-update-更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-update-更新"}},[s._v("#")]),s._v(" 1.2.2 update 更新")]),s._v(" "),a("p",[s._v("更新 tablename 表，将其中所有符合 condition 记录的 column1 属性更新为 value1")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("UPDATE tablename\nSET column1 = value1\nWHERE condition;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"_1-2-3-delete-删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-delete-删除"}},[s._v("#")]),s._v(" 1.2.3 delete 删除")]),s._v(" "),a("p",[s._v("删除 tablename 表中所有符合 condition 的记录，如果 condition 恒为 true，则删除表的所有记录。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("DELETE FROM tablename\nWHERE condition;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("还有一个 DDL 语句可以实现删除表的所有记录：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("TRUNCATE TABLE tablename;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_1-2-4-select-查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-select-查询"}},[s._v("#")]),s._v(" 1.2.4 select 查询")]),s._v(" "),a("ul",[a("li",[s._v("基本查询")])]),s._v(" "),a("p",[s._v("查询 tablename 表中的所有数据。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM tablename;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("也可以不跟 "),a("code",[s._v("FROM")]),s._v(" 子句，用于直接计算表达式。常用于检查数据库连接，比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT 1;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("条件查询")])]),s._v(" "),a("p",[s._v("可以只查询符合条件的数据。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * FROM tablename \nWHERE condition;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("condition")]),s._v(" 由逻辑表达式或者子条件组成，各子条件可以由 "),a("code",[s._v("NOT")]),s._v("/"),a("code",[s._v("AND")]),s._v("/"),a("code",[s._v("OR")]),s._v(" 来修饰和连接。\n不使用括号时，优先级从高到低依次是 "),a("code",[s._v("NOT")]),s._v("/"),a("code",[s._v("AND")]),s._v("/"),a("code",[s._v("OR")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v("投影查询")])]),s._v(" "),a("p",[s._v("可以只查询部分属性(列)，这种操作称为投影。同时列名也可以映射为自定义的名称：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT column1 AS col1, column2 AS col2\nFROM tablename\nWHERE condition;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("查询 "),a("code",[s._v("tablename")]),s._v(" 表中符合 "),a("code",[s._v("condition")]),s._v(" 条件的数据，最后只显示 column1 和 column2 的属性值，同时将 column1 的名称映射为 col1，将 column2 的名称映射为 col2.")]),s._v(" "),a("ul",[a("li",[s._v("查询结果排序")])]),s._v(" "),a("p",[s._v("查询结果默认是以主键排序的。用户可以使用 "),a("code",[s._v("ORDER BY")]),s._v(" 子句实现自定义的结果集排序：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT id, name, age\nFROM person\nWHERE id < 100\nORDER BY age;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("顺序分为升序(ASC) 和降序(DESC)，默认不写就是升序，如果使用降序：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT id, name, age\nFROM person\nWHERE id < 100\nORDER BY age DESC;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("可以同时对多列属性进行排序，比如有两个列参与排序：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT id, name, age, score\nFROM person\nWHERE id < 100\nORDER BY age DESC, score;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("先按照 age 倒序排列，age 属性相同时按照 score 正序排列。")]),s._v(" "),a("ul",[a("li",[s._v("查询结果分组")])]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("GROUP BY")]),s._v(" 子句对结果集进行分组：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT age, score, count(*) AS sum\nFROM person\nWHERE id < 100\nGROUP BY age, score\nORDER BY sum;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("1、"),a("code",[s._v("GROUP BY")]),s._v(" 在 "),a("code",[s._v("WHERE")]),s._v(" 后，"),a("code",[s._v("ORDER BY")]),s._v(" 前。")]),s._v(" "),a("p",[s._v("2、"),a("code",[s._v("SELECT")]),s._v(" 子句选择的属性必须在 "),a("code",[s._v("GROUP BY")]),s._v(" 中出现（除汇总函数外，例如 count(*)）。")]),s._v(" "),a("p",[s._v("3、如果分组的属性在某些记录中为 NULL，则 NULL 会单独分组。")]),s._v(" "),a("ul",[a("li",[s._v("分页查询")])]),s._v(" "),a("p",[s._v("当结果集过大而一次不用使用全部结果集时，可以使用 "),a("code",[s._v("LIMIT m OFFSET n")]),s._v(" 子句进行手动分页：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT id, name, age, score\nFROM person\nORDER BY age DESC, score\nLIMIT 5 OFFSET 0;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("每页5条记录，当前取第1页。")]),s._v(" "),a("ul",[a("li",[s._v("连接查询\n"),a("ul",[a("li",[s._v("内连接，又称等值连接，只保留两表匹配字段。")]),s._v(" "),a("li",[s._v("左(外)连接，保留左侧表未匹配字段。")]),s._v(" "),a("li",[s._v("右(外)连接，保留右侧表未匹配字段。")]),s._v(" "),a("li",[s._v("全外连接 ，保留所有未匹配字段。")])])]),s._v(" "),a("li",[s._v("笛卡尔积查询")])]),s._v(" "),a("p",[s._v("假设有两张表，记录数分别为 M 和 N，将两张表的记录一一组合形成 M*N 行记录的结果集就是笛卡尔积。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT * \nFROM students, classes;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("实际应用中要尽量避免使用笛卡尔积，因为查询结果可能会很大，比如两张超过1万条记录的表进行笛卡尔积查询，结果集超过1亿条。")]),s._v(" "),a("ul",[a("li",[s._v("组合查询")])]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("UNION")]),s._v(" 关键字可以将两个查询结果组合起来，两个查询结果集分别为 M 行和 N 行，则组合结果有 M + N 行。")]),s._v(" "),a("p",[s._v("使用前提是两个查询结果集列一致。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT name,age,score\nFROM student1\nWHERE age = 10\nUNION\nSELECT name,age,score\nFROM student2\nWHERE age = 18\nORDER BY score;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("组合查询只能有一个 "),a("code",[s._v("ORDER BY")]),s._v(" 子句，且必须在最后。")]),s._v(" "),a("p",[s._v("默认会去重，如果不去重，需要使用 "),a("code",[s._v("UNION ALL")]),s._v(" 关键字。")]),s._v(" "),a("ul",[a("li",[s._v("子查询")])]),s._v(" "),a("p",[s._v("子查询也是查询的一种，结果集只能有 1 列。结果集常用做其他查询的条件/结果的组成部分。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SELECT *\nFROM student\nWHERE classid IN(SELECT classid\n                  FROM class\n                  WHERE rank > 1)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_2-存储程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-存储程序"}},[s._v("#")]),s._v(" 2. 存储程序")]),s._v(" "),a("p",[s._v("Stored Program 是一种存储对象，功能和高级语言编写的程序类似，封装了一系列的 SQL 操作，有的可以被调用、有的可以被触发。")]),s._v(" "),a("p",[a("em",[s._v("ps:由于存储程序大多依赖于具体数据库实现，这里仅以 MySQL 为例进行描述。")])]),s._v(" "),a("h3",{attrs:{id:"_2-1-复合语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-复合语句"}},[s._v("#")]),s._v(" 2.1 复合语句")]),s._v(" "),a("p",[s._v("编写存储程序常用到复合语句，这种语句包含多条 SQL 语句，同时还可以使用逻辑判断/条件语句/循环/变量，每个语句由分号 "),a("code",[s._v(";")]),s._v(" 结束。")]),s._v(" "),a("p",[s._v("整体的复合语句由 "),a("code",[s._v("BEGIN")]),s._v(" 开始，"),a("code",[s._v("END;")]),s._v(" 结束。")]),s._v(" "),a("p",[s._v("特别的，如果使用MySQL客户端命令行编写复合语句，由于 "),a("code",[s._v(";")]),s._v(" 同时也是客户端的默认分隔符，可以使用 "),a("code",[s._v("delimiter")]),s._v(" 命令将分隔符先临时改为其他符号，在编写完复合语句后再改回来，以包含在存储过程中的复合语句为例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("delimiter $\nCREATE PROCEDURE test()\nBEGIN\n  SELECT ...... ;\n  SELECT ...... ;\nEND$\ndelimiter ;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_2-2-存储函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-存储函数"}},[s._v("#")]),s._v(" 2.2 存储函数")]),s._v(" "),a("p",[s._v("Stored Function 可以看做用户自定义的函数，创建/修改存储函数需要有管理权限。")]),s._v(" "),a("p",[s._v("存储函数不能修改数据，只能包含查询语句和计算过程。基本语法如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE FUNCTION test([param_list])\n  RETURN type\n  routine_stmt # 复合语句\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("存储函数有且只能有一个返回值。要返回多个值，要么在一个查询语句中调用多个存储函数，要么使用存储过程。")]),s._v(" "),a("p",[s._v("调用存储函数和使用系统内建函数一样（如果和内建函数同名，需要在前面加数据库限定名），直接在表达式中使用。")]),s._v(" "),a("h3",{attrs:{id:"_2-3-存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-存储过程"}},[s._v("#")]),s._v(" 2.3 存储过程")]),s._v(" "),a("p",[s._v("Stored procedure 可以看做一组预编译的 SQL 集合，SQL 能做的操作，存储过程基本都能做。")]),s._v(" "),a("p",[s._v("存储过程不包含 RETURN 子句，基本语法如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE FUNCTION test([param_list])\n  routine_stmt # 复合语句\n  \nCALL test([param_list]); # 调用存储过程\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("存储过程的参数分为3种类型：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("IN")]),s._v(" 默认类型，传入参数，存储过程可以把这个参数作为变量使用，也可以在过程中修改此参数，但是修改对调用者不可见。")]),s._v(" "),a("li",[a("code",[s._v("OUT")]),s._v(" 传出参数，存储过程可以通过 "),a("code",[s._v("SET")]),s._v(" 子句赋值给这些变量，而调用者可以在过程返回后，可以使用这些参数获取返回值。")]),s._v(" "),a("li",[a("code",[s._v("INOUT")]),s._v("顾名思义，同时作为传入和传出参数，类似代码中的引用传递。")])]),s._v(" "),a("p",[s._v("与存储函数的区别：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th",[s._v("返回值")]),s._v(" "),a("th",[s._v("参数")]),s._v(" "),a("th",[s._v("能否修改数据库中的数据")]),s._v(" "),a("th",[s._v("调用方式")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("存储函数")]),s._v(" "),a("td",[s._v("用RETURN子句返回，只能有1个返回值")]),s._v(" "),a("td",[s._v("只有 "),a("code",[s._v("IN")]),s._v(" 参数")]),s._v(" "),a("td",[s._v("不能")]),s._v(" "),a("td",[s._v("直接在表达式中使用，和内建函数一样")])]),s._v(" "),a("tr",[a("td",[s._v("存储过程")]),s._v(" "),a("td",[s._v("通过 "),a("code",[s._v("OUT")]),s._v(" 或 "),a("code",[s._v("INOUT")]),s._v(" 类型参数返回，可以有多个")]),s._v(" "),a("td",[s._v("可以有 "),a("code",[s._v("IN")]),s._v("/"),a("code",[s._v("OUT")]),s._v("/"),a("code",[s._v("INOUT")]),s._v("等 3 种参数")]),s._v(" "),a("td",[s._v("能")]),s._v(" "),a("td",[s._v("必须使用 "),a("code",[s._v("CALL")]),s._v(" 子句调用")])])])]),s._v(" "),a("h3",{attrs:{id:"_2-4-触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-触发器"}},[s._v("#")]),s._v(" 2.4 触发器")]),s._v(" "),a("p",[s._v("Trigger 可以看做和特定表关联的存储过程，其中定义的内容会在执行特定表的 "),a("code",[s._v("INSERT")]),s._v("/"),a("code",[s._v("DELETE")]),s._v("/"),a("code",[s._v("UPDATE")]),s._v(" 语句时被自动激活，激活时机可以设置在语句执行前或者执行后。")]),s._v(" "),a("p",[s._v("定义触发器时需要显式指定触发它的语句类型和触发时机，基本语法如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE TRIGGER trigger_test\n  {BEFORE | AFTER}\n  {INSERT | UPDATE | DELETE}\n  ON table_name             # 关联表\n  FOR EACH ROW trigger_stmt # 触发器内容\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在触发器内容体内可以使用 "),a("code",[s._v("NEW")]),s._v(" 限定名代指 "),a("code",[s._v("INSERT")]),s._v(" 或 "),a("code",[s._v("UPDATE")]),s._v(" 操作中被插入或修改的新行数据，用 "),a("code",[s._v("NEW.column")]),s._v(" 表示该行的某一个属性。")]),s._v(" "),a("p",[s._v("相同的，可以使用 "),a("code",[s._v("OLD")]),s._v(" 限定名代指 "),a("code",[s._v("DELETE")]),s._v(" 或 "),a("code",[s._v("UPDATE")]),s._v(" 操作中被删除或修改的旧行数据，用 "),a("code",[s._v("OLD.column")]),s._v(" 表示该行的某个属性。")]),s._v(" "),a("p",[s._v("需要注意的是触发器的权限属于特定表，需要拥有对应表的 "),a("code",[s._v("TRIGGER")]),s._v(" 权限才能创建/删除触发器。")]),s._v(" "),a("h3",{attrs:{id:"_2-5-事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-事件"}},[s._v("#")]),s._v(" 2.5 事件")]),s._v(" "),a("p",[s._v("MySQL 有内置的事件调度器，可以拥有定时执行一系列的数据库操作。默认是不会启用的，要使用事件调度器执行事件需要先设置配置项：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SET GLOBAL event_scheduler = ON;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("事件定义由计划时间和事件内容组成，基本语法如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE EVENT event_name\n  ON SCHEDULE {AT datetime | EVERY expr interval [STARTS datetime] [ENDS datetime]}\n  DO event_stmt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("例如，每4小时清理历史记录表中超过一天的记录：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CREATE EVENT expire_web_history\n  ON SCHEDULE EVERY 4 HOUR\n  DO\n    DELETE FROM web_history\n    WHERE last_visit < CURRENT_TIMESTAMP - INTERVAL 1 DAY;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);